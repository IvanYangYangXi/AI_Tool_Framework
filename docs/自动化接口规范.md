<!-- 
  DCCå·¥å…·ç®¡ç†æ¡†æ¶ - è‡ªåŠ¨åŒ–æ¥å£è§„èŒƒ
  ç‰ˆæœ¬: 1.0.0
  æ›´æ–°æ—¥æœŸ: 2026-02-16
-->

# âš™ï¸ è‡ªåŠ¨åŒ–æ¥å£è§„èŒƒ

> æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜è‡ªåŠ¨åŒ–ç³»ç»Ÿçš„æ¥å£ã€æ•°æ®æµå’Œæ‰©å±•æ–¹æ³•

---

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
2. [æ ¸å¿ƒç±»æ¥å£](#æ ¸å¿ƒç±»æ¥å£)
3. [æ‰§è¡Œå›è°ƒæ¥å£](#æ‰§è¡Œå›è°ƒæ¥å£)
4. [è§¦å‘å™¨ç³»ç»Ÿ](#è§¦å‘å™¨ç³»ç»Ÿ)
5. [ä»»åŠ¡é“¾é…ç½®](#ä»»åŠ¡é“¾é…ç½®)
6. [æ—¥å¿—è¾“å‡ºè§„èŒƒ](#æ—¥å¿—è¾“å‡ºè§„èŒƒ)
7. [é”™è¯¯å¤„ç†](#é”™è¯¯å¤„ç†)
8. [æ‰©å±•æŒ‡å—](#æ‰©å±•æŒ‡å—)

---

## æ¶æ„æ¦‚è¿°

### ğŸ—ï¸ ç»„ä»¶å…³ç³»å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LightweightManager (GUI)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  execute_callback = _execute_tool_for_automation          â”‚  â”‚
â”‚  â”‚  (æ³¨å†Œè‡ªåŠ¨åŒ–æ‰§è¡Œå›è°ƒ)                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                  â”‚
â”‚                               â–¼                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            AutomationManager                               â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ _scheduler_loop() - 1ç§’è½®è¯¢è°ƒåº¦                       â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ _execute_task() - ä»»åŠ¡æ‰§è¡Œå…¥å£                        â”‚  â”‚
â”‚  â”‚  â”œâ”€â”€ _execute_task_chain() - ä»»åŠ¡é“¾æ‰§è¡Œ                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€ execute_callback - GUIæ³¨å†Œçš„å›è°ƒå‡½æ•°                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                               â”‚                                  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚                    â–¼                     â–¼                      â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚          â”‚ ç‹¬ç«‹æ¨¡å¼æ‰§è¡Œ     â”‚   â”‚ DCCæ¨¡å¼æ‰§è¡Œ      â”‚              â”‚
â”‚          â”‚ (subprocess)    â”‚   â”‚ (Socket/HTTP)   â”‚              â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ“¦ æ ¸å¿ƒæ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ |
|------|------|
| `lightweight_manager.py` | GUIä¸»ç¨‹åºï¼Œæ³¨å†Œæ‰§è¡Œå›è°ƒ |
| `automation_manager.py` | è‡ªåŠ¨åŒ–è°ƒåº¦æ ¸å¿ƒ |
| `automation_dialog.py` | ä»»åŠ¡ç®¡ç†UIå¯¹è¯æ¡† |
| `trigger_config_widget.py` | è§¦å‘å™¨é…ç½®UIç»„ä»¶ |

---

## æ ¸å¿ƒç±»æ¥å£

### ğŸ“ AutomationTask æ•°æ®ç±»

```python
@dataclass
class AutomationTask:
    """è‡ªåŠ¨åŒ–ä»»åŠ¡æ•°æ®ç»“æ„"""
    
    task_id: str                    # å”¯ä¸€ID (UUID)
    name: str                       # ä»»åŠ¡åç§°
    tool_id: str                    # å…³è”çš„å·¥å…·ID
    tool_path: str                  # å·¥å…·è·¯å¾„
    trigger_type: str               # è§¦å‘å™¨ç±»å‹
    trigger_config: Dict[str, Any]  # è§¦å‘å™¨é…ç½®
    enabled: bool = True            # æ˜¯å¦å¯ç”¨
    parameters: Dict[str, Any]      # æ‰§è¡Œå‚æ•°
    status: str = "idle"            # ä»»åŠ¡çŠ¶æ€
    last_run: datetime = None       # ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´
    next_run: datetime = None       # ä¸‹æ¬¡æ‰§è¡Œæ—¶é—´
    created_at: datetime = None     # åˆ›å»ºæ—¶é—´
    task_chain_config: Dict = None  # ä»»åŠ¡é“¾é…ç½®ï¼ˆä»…task_chainç±»å‹ï¼‰
```

### ğŸ“ ä»»åŠ¡çŠ¶æ€æšä¸¾

| çŠ¶æ€ | å€¼ | è¯´æ˜ |
|------|------|------|
| ç©ºé—² | `idle` | åˆå§‹çŠ¶æ€ |
| ç­‰å¾…ä¸­ | `waiting` | ç­‰å¾…è§¦å‘æ¡ä»¶ |
| è¿è¡Œä¸­ | `running` | æ­£åœ¨æ‰§è¡Œ |
| å·²å®Œæˆ | `completed` | æ‰§è¡ŒæˆåŠŸ |
| å·²æš‚åœ | `paused` | å·²ç¦ç”¨ |
| é”™è¯¯ | `error` | æ‰§è¡Œå¤±è´¥ |

### ğŸ“ AutomationManager æ¥å£

```python
class AutomationManager:
    """è‡ªåŠ¨åŒ–ä»»åŠ¡ç®¡ç†å™¨"""
    
    def __init__(self, config_dir: str = "./configs"):
        """
        åˆå§‹åŒ–ç®¡ç†å™¨
        
        Args:
            config_dir: é…ç½®æ–‡ä»¶å­˜å‚¨ç›®å½•
        """
    
    def set_execute_callback(
        self, 
        callback: Callable[[str, str, str, Dict], Dict]
    ):
        """
        è®¾ç½®å·¥å…·æ‰§è¡Œå›è°ƒ
        
        Args:
            callback: å›è°ƒå‡½æ•°ï¼Œç­¾å: (tool_id, category, mode, params) -> dict
        """
    
    def create_task(
        self,
        name: str,
        tool_id: str,
        tool_path: str,
        trigger_type: str,
        trigger_config: Dict[str, Any],
        parameters: Dict[str, Any] = None,
        task_chain_config: Dict[str, Any] = None
    ) -> str:
        """
        åˆ›å»ºè‡ªåŠ¨åŒ–ä»»åŠ¡
        
        Returns:
            task_id: æ–°ä»»åŠ¡çš„å”¯ä¸€ID
        """
    
    def update_task(
        self,
        task_id: str,
        **kwargs
    ) -> bool:
        """æ›´æ–°ä»»åŠ¡é…ç½®"""
    
    def delete_task(self, task_id: str) -> bool:
        """åˆ é™¤ä»»åŠ¡"""
    
    def run_task_now(self, task_id: str) -> bool:
        """ç«‹å³æ‰§è¡Œä»»åŠ¡ï¼ˆæ‰‹åŠ¨è§¦å‘ï¼‰"""
    
    def get_all_tasks(self) -> List[AutomationTask]:
        """è·å–æ‰€æœ‰ä»»åŠ¡åˆ—è¡¨"""
    
    def start(self):
        """å¯åŠ¨è°ƒåº¦å™¨"""
    
    def stop(self):
        """åœæ­¢è°ƒåº¦å™¨"""
```

---

## æ‰§è¡Œå›è°ƒæ¥å£

### ğŸ”„ å›è°ƒå‡½æ•°ç­¾å

```python
def execute_callback(
    tool_id: str,
    category: str,
    mode: str,
    params: Dict[str, Any]
) -> Dict[str, Any]:
    """
    è‡ªåŠ¨åŒ–æ‰§è¡Œå›è°ƒå‡½æ•°
    
    Args:
        tool_id: å·¥å…·å”¯ä¸€æ ‡è¯†ç¬¦
        category: å·¥å…·åˆ†ç±» (maya/max/blender/ue/other)
        mode: æ‰§è¡Œæ¨¡å¼ (standalone/dcc)
        params: æ‰§è¡Œå‚æ•°å­—å…¸
    
    Returns:
        æ‰§è¡Œç»“æœ:
        {
            "status": "success" | "error",
            "result": <æ‰§è¡Œç»“æœæ•°æ®>,
            "message": "æè¿°ä¿¡æ¯"
        }
    """
```

### ğŸ–¥ï¸ LightweightManager ä¸­çš„å®ç°

```python
def _execute_tool_for_automation(
    self,
    tool_id: str,
    category: str,
    mode: str,
    params: dict
) -> dict:
    """è‡ªåŠ¨åŒ–ä»»åŠ¡æ‰§è¡Œå›è°ƒ"""
    try:
        # 1. æŸ¥æ‰¾å·¥å…·ä¿¡æ¯
        tool_info = self._find_tool_by_id(tool_id)
        if not tool_info:
            return {"status": "error", "message": f"æ‰¾ä¸åˆ°å·¥å…·: {tool_id}"}
        
        # 2. æ ¹æ®æ¨¡å¼æ‰§è¡Œ
        if mode == "standalone":
            # ç‹¬ç«‹æ¨¡å¼ - ä½¿ç”¨subprocessæ‰§è¡Œ
            result = self._execute_standalone_tool(tool_info, params)
            return {"status": "success", "result": result}
        else:
            # DCCæ¨¡å¼ - å‘é€åˆ°DCCè½¯ä»¶
            if not self.connected_dcc:
                return {"status": "error", "message": "è¯·å…ˆè¿æ¥åˆ°DCCè½¯ä»¶"}
            
            dcc_type = self.connected_dcc
            if dcc_type == "Maya":
                self._execute_in_maya_for_automation(tool_info, params)
            elif dcc_type == "Unreal Engine":
                self._execute_in_ue_for_automation(tool_info, params)
            # ...å…¶ä»–DCC
            
            return {"status": "success", "message": f"å·²å‘é€åˆ° {dcc_type}"}
            
    except Exception as e:
        return {"status": "error", "message": str(e)}
```

### ğŸ“¡ DCCæ‰§è¡Œæ–¹æ³•

#### Mayaæ‰§è¡Œ

```python
def _execute_in_maya_for_automation(
    self, 
    tool_info: dict, 
    params: dict
):
    """åœ¨Mayaä¸­æ‰§è¡Œå·¥å…·"""
    tool_path = Path(tool_info['path'])
    plugin_file = tool_path / "plugin.py"
    
    # ç”ŸæˆMayaæ‰§è¡Œä»£ç 
    maya_code = self._generate_maya_execution_code(
        tool_info, params, plugin_file
    )
    
    # å‘é€åˆ°Maya (è¿”å›ä¸‰å…ƒç»„)
    success, message, maya_output = self._send_to_maya(maya_code)
    
    if not success:
        raise Exception(f"Mayaæ‰§è¡Œå¤±è´¥: {message}")
    
    # æ‰“å°è¾“å‡ºåˆ°GUIæ—¥å¿—
    if maya_output:
        self.root.after(0, lambda: self._log_maya_automation_output(
            tool_info.get('name', 'Mayaå·¥å…·'), 
            maya_output
        ))
```

#### UEæ‰§è¡Œ

```python
def _execute_in_ue_for_automation(
    self, 
    tool_info: dict, 
    params: dict
):
    """åœ¨Unreal Engineä¸­æ‰§è¡Œå·¥å…·"""
    tool_path = Path(tool_info['path'])
    plugin_file = tool_path / "plugin.py"
    
    # ç”ŸæˆUEæ‰§è¡Œä»£ç 
    ue_code = self._generate_ue_execution_code(
        tool_info, params, plugin_file
    )
    
    # å‘é€åˆ°UE (è¿”å›ä¸‰å…ƒç»„)
    result = self._send_to_ue(ue_code)
    success = result[0] if len(result) > 0 else False
    message = result[1] if len(result) > 1 else "Unknown error"
    output = result[2] if len(result) > 2 else ""
    
    if not success:
        raise Exception(f"UEæ‰§è¡Œå¤±è´¥: {message}")
    
    # æ‰“å°è¾“å‡ºåˆ°GUIæ—¥å¿—
    if output:
        self.root.after(0, lambda: self._log_ue_automation_output(
            tool_info.get('name', 'UEå·¥å…·'), 
            output
        ))
```

---

## è§¦å‘å™¨ç³»ç»Ÿ

### â° è§¦å‘å™¨ç±»å‹

| ç±»å‹ | trigger_type | è¯´æ˜ |
|------|--------------|------|
| æ‰‹åŠ¨ | `manual` | ä»…æ‰‹åŠ¨è§¦å‘ |
| é—´éš” | `interval` | å›ºå®šé—´éš”æ‰§è¡Œ |
| å®šæ—¶ | `scheduled` | æŒ‡å®šæ—¶é—´æ‰§è¡Œ |
| æ–‡ä»¶ç›‘æ§ | `file_watch` | æ–‡ä»¶å˜åŒ–æ—¶æ‰§è¡Œ |
| ä»»åŠ¡é“¾ | `task_chain` | é¡ºåºæ‰§è¡Œå¤šä¸ªè„šæœ¬ |

### ğŸ“‹ è§¦å‘å™¨é…ç½®æ ¼å¼

#### é—´éš”è§¦å‘å™¨

```python
{
    "type": "interval",
    "interval_value": 5,        # é—´éš”æ•°å€¼
    "interval_unit": "minutes"  # seconds/minutes/hours
}
```

#### å®šæ—¶è§¦å‘å™¨

```python
{
    "type": "scheduled",
    "schedule_type": "daily",   # daily/weekly/once
    "time": "09:00",            # æ‰§è¡Œæ—¶é—´
    "weekday": 0,               # 0-6 (ä»…weekly)
    "date": "2026-02-16"        # å…·ä½“æ—¥æœŸ (ä»…once)
}
```

#### æ–‡ä»¶ç›‘æ§è§¦å‘å™¨

```python
{
    "type": "file_watch",
    "watch_path": "D:/Projects/Assets",
    "patterns": ["*.fbx", "*.obj"],
    "events": ["created", "modified"]  # created/modified/deleted
}
```

#### ä»»åŠ¡é“¾è§¦å‘å™¨

```python
{
    "type": "task_chain",
    "chain_tools": [
        {
            "id": "tool_id_1",
            "name": "å·¥å…·1",
            "category": "maya",
            "mode": "dcc"
        },
        {
            "id": "tool_id_2",
            "name": "å·¥å…·2",
            "category": "other",
            "mode": "standalone"
        }
    ],
    "on_error": "stop",    # stop/continue
    "delay_seconds": 2     # è„šæœ¬é—´å»¶è¿Ÿ
}
```

---

## ä»»åŠ¡é“¾é…ç½®

### ğŸ”— ä»»åŠ¡é“¾æ•°æ®ç»“æ„

ä»»åŠ¡é“¾å…è®¸æŒ‰é¡ºåºæ‰§è¡Œå¤šä¸ªè„šæœ¬ï¼Œæ¯ä¸ªè„šæœ¬å¯ç‹¬ç«‹é…ç½®æ‰§è¡Œæ¨¡å¼ï¼š

```python
task_chain_config = {
    "chain_tools": [
        {
            "id": "example_print_selection",   # å·¥å…·ID
            "name": "æ‰“å°é€‰æ‹©",                 # æ˜¾ç¤ºåç§°
            "category": "maya",                 # å·¥å…·åˆ†ç±»
            "mode": "dcc"                       # æ‰§è¡Œæ¨¡å¼
        },
        {
            "id": "backup_scene",
            "name": "å¤‡ä»½åœºæ™¯",
            "category": "other",
            "mode": "standalone"
        }
    ],
    "on_error": "stop",      # é”™è¯¯å¤„ç†: stop=åœæ­¢, continue=ç»§ç»­
    "delay_seconds": 2       # è„šæœ¬é—´å»¶è¿Ÿç§’æ•°
}
```

### ğŸ”„ ä»»åŠ¡é“¾æ‰§è¡Œæµç¨‹

```
å¼€å§‹ä»»åŠ¡é“¾
    â”‚
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ for tool in chain_tools:    â”‚
â”‚   â”‚                         â”‚
â”‚   â”œâ”€â–¶ æ‰§è¡Œè„šæœ¬              â”‚
â”‚   â”‚   â”‚                     â”‚
â”‚   â”‚   â”œâ”€ æˆåŠŸ â”€â–¶ ç­‰å¾…å»¶è¿Ÿ   â”‚
â”‚   â”‚   â”‚          â–¼          â”‚
â”‚   â”‚   â”‚        ç»§ç»­ä¸‹ä¸€ä¸ª   â”‚
â”‚   â”‚   â”‚                     â”‚
â”‚   â”‚   â””â”€ å¤±è´¥ â”€â–¶ æ£€æŸ¥ç­–ç•¥   â”‚
â”‚   â”‚              â”‚          â”‚
â”‚   â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚       â–¼             â–¼   â”‚
â”‚   â”‚   on_error=    on_error=â”‚
â”‚   â”‚   "stop"       "continueâ”‚
â”‚   â”‚      â”‚              â”‚   â”‚
â”‚   â”‚   ç»ˆæ­¢é“¾        ç»§ç»­é“¾  â”‚
â”‚   â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
ä»»åŠ¡é“¾å®Œæˆ
```

---

## æ—¥å¿—è¾“å‡ºè§„èŒƒ

### ğŸ“ GUIæ—¥å¿—æ–¹æ³•

```python
def log_message(self, message: str):
    """è¾“å‡ºæ—¥å¿—åˆ°GUIé¢æ¿"""
    timestamp = datetime.now().strftime("[%H:%M:%S]")
    full_message = f"{timestamp} {message}"
    # æ·»åŠ åˆ°æ—¥å¿—æ–‡æœ¬æ¡†
    self.log_text.insert(tk.END, full_message + "\n")
```

### ğŸ“¤ DCCè¾“å‡ºæ—¥å¿—æ–¹æ³•

```python
def _log_maya_automation_output(self, tool_name: str, output: str):
    """æ‰“å°Mayaè‡ªåŠ¨åŒ–æ‰§è¡Œçš„è¾“å‡ºæ—¥å¿—"""
    self.log_message(f"[è‡ªåŠ¨åŒ–] Maya '{tool_name}' è¾“å‡º:")
    lines = output.strip().split('\n') if output else []
    for i, line in enumerate(lines[:20]):
        if line.strip():
            self.log_message(f"  {line}")
    if len(lines) > 20:
        self.log_message(f"  ... (å…± {len(lines)} è¡Œè¾“å‡º)")

def _log_ue_automation_output(self, tool_name: str, output: str):
    """æ‰“å°UEè‡ªåŠ¨åŒ–æ‰§è¡Œçš„è¾“å‡ºæ—¥å¿—"""
    self.log_message(f"[è‡ªåŠ¨åŒ–] UE '{tool_name}' è¾“å‡º:")
    lines = output.strip().split('\n') if output else []
    for i, line in enumerate(lines[:20]):
        if line.strip():
            self.log_message(f"  {line}")
    if len(lines) > 20:
        self.log_message(f"  ... (å…± {len(lines)} è¡Œè¾“å‡º)")
```

### ğŸ“‹ æ—¥å¿—æ ¼å¼è§„èŒƒ

| å‰ç¼€ | ç”¨é€” | ç¤ºä¾‹ |
|------|------|------|
| `[è‡ªåŠ¨åŒ–]` | è‡ªåŠ¨åŒ–ç³»ç»Ÿæ¶ˆæ¯ | `[è‡ªåŠ¨åŒ–] æ‰§è¡Œå·¥å…·: xxx` |
| `[è‡ªåŠ¨åŒ–] âœ“` | æ‰§è¡ŒæˆåŠŸ | `[è‡ªåŠ¨åŒ–] âœ“ å·¥å…· 'xxx' å·²å‘é€åˆ° UE` |
| `[è‡ªåŠ¨åŒ–] âœ—` | æ‰§è¡Œå¤±è´¥ | `[è‡ªåŠ¨åŒ–] âœ— DCCæ‰§è¡Œé”™è¯¯: ...` |
| `[n/m]` | ä»»åŠ¡é“¾è¿›åº¦ | `[1/3] æ‰§è¡Œè„šæœ¬: xxx` |

---

## é”™è¯¯å¤„ç†

### âš ï¸ é”™è¯¯ç±»å‹

| é”™è¯¯ | åŸå›  | å¤„ç† |
|------|------|------|
| å·¥å…·æœªæ‰¾åˆ° | tool_idä¸å­˜åœ¨ | è¿”å›errorçŠ¶æ€ |
| DCCæœªè¿æ¥ | æ‰§è¡ŒDCCæ¨¡å¼ä½†æœªè¿æ¥ | æç¤ºè¿æ¥DCC |
| æ‰§è¡Œè¶…æ—¶ | è„šæœ¬æ‰§è¡Œæ—¶é—´è¿‡é•¿ | ç»ˆæ­¢å¹¶æŠ¥é”™ |
| DCCé€šä¿¡å¤±è´¥ | Socket/HTTPè¿æ¥å¤±è´¥ | æŠ›å‡ºå¼‚å¸¸ |

### ğŸ”§ å¼‚å¸¸å¤„ç†æ¨¡å¼

```python
def _execute_task(self, task: AutomationTask):
    """æ‰§è¡Œå•ä¸ªä»»åŠ¡"""
    try:
        task.status = "running"
        task.last_run = datetime.now()
        
        if task.trigger_type == "task_chain":
            self._execute_task_chain(task)
        else:
            self._execute_single_tool(task)
        
        task.status = "completed"
        
    except Exception as e:
        task.status = "error"
        logger.error(f"ä»»åŠ¡ {task.name} æ‰§è¡Œå¤±è´¥: {e}")
        
        # å›è°ƒé€šçŸ¥UI
        if self.on_task_error:
            self.on_task_error(task, str(e))
```

---

## æ‰©å±•æŒ‡å—

### ğŸ†• æ·»åŠ æ–°çš„DCCæ”¯æŒ

1. **åœ¨ `lightweight_manager.py` ä¸­æ·»åŠ æ‰§è¡Œæ–¹æ³•ï¼š**

```python
def _execute_in_newdcc_for_automation(
    self, 
    tool_info: dict, 
    params: dict
):
    """åœ¨NewDCCä¸­æ‰§è¡Œå·¥å…·"""
    tool_path = Path(tool_info['path'])
    plugin_file = tool_path / "plugin.py"
    
    # ç”Ÿæˆæ‰§è¡Œä»£ç 
    code = self._generate_newdcc_execution_code(
        tool_info, params, plugin_file
    )
    
    # å‘é€åˆ°DCC
    success, message, output = self._send_to_newdcc(code)
    
    if not success:
        raise Exception(f"NewDCCæ‰§è¡Œå¤±è´¥: {message}")
    
    # æ‰“å°è¾“å‡º
    if output:
        self.root.after(0, lambda: self._log_newdcc_automation_output(
            tool_info.get('name'), output
        ))
```

2. **åœ¨æ‰§è¡Œå›è°ƒä¸­æ·»åŠ åˆ†æ”¯ï¼š**

```python
def _execute_tool_for_automation(...):
    # ...
    if dcc_type == "NewDCC":
        self._execute_in_newdcc_for_automation(tool_info, params)
```

3. **æ·»åŠ æ—¥å¿—è¾“å‡ºæ–¹æ³•ï¼š**

```python
def _log_newdcc_automation_output(self, tool_name: str, output: str):
    """æ‰“å°NewDCCè‡ªåŠ¨åŒ–æ‰§è¡Œçš„è¾“å‡ºæ—¥å¿—"""
    self.log_message(f"[è‡ªåŠ¨åŒ–] NewDCC '{tool_name}' è¾“å‡º:")
    lines = output.strip().split('\n') if output else []
    for line in lines[:20]:
        if line.strip():
            self.log_message(f"  {line}")
```

### ğŸ†• æ·»åŠ æ–°çš„è§¦å‘å™¨ç±»å‹

1. **åœ¨ `trigger_manager.py` ä¸­æ³¨å†Œï¼š**

```python
TRIGGER_TYPES = {
    # ... ç°æœ‰è§¦å‘å™¨
    "new_trigger": {
        "name": "æ–°è§¦å‘å™¨",
        "description": "è§¦å‘å™¨æè¿°",
        "config_schema": {
            "param1": {"type": "string", "required": True},
            "param2": {"type": "int", "default": 10}
        }
    }
}
```

2. **åœ¨ `trigger_config_widget.py` ä¸­æ·»åŠ é…ç½®UI**

3. **åœ¨ `automation_manager.py` ä¸­æ·»åŠ è§¦å‘é€»è¾‘**

---

## é™„å½•ï¼šæ¥å£é€ŸæŸ¥è¡¨

### AutomationManager æ–¹æ³•

| æ–¹æ³• | å‚æ•° | è¿”å› |
|------|------|------|
| `create_task()` | name, tool_id, ... | task_id: str |
| `update_task()` | task_id, **kwargs | bool |
| `delete_task()` | task_id | bool |
| `run_task_now()` | task_id | bool |
| `get_all_tasks()` | - | List[AutomationTask] |
| `start()` | - | None |
| `stop()` | - | None |

### æ‰§è¡Œå›è°ƒè¿”å›æ ¼å¼

```python
# æˆåŠŸ
{"status": "success", "result": ..., "message": "..."}

# å¤±è´¥
{"status": "error", "message": "é”™è¯¯æè¿°"}
```

### DCCæ–¹æ³•è¿”å›æ ¼å¼

```python
# ä¸‰å…ƒç»„è¿”å›
(success: bool, message: str, output: str)
```

---

*æ–‡æ¡£ç‰ˆæœ¬: 1.0.0 | æœ€åæ›´æ–°: 2026-02-16*
